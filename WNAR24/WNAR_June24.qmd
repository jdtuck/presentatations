---
title: Elastic Functional Changepoint Detection with Application to Climate Engineering
format: clean-revealjs
revealjs-plugins:
  - pointer
author:
  - name: J. Derek Tucker
    orcid: 0000-0001-8844-2169
    email: jdtuck@sandia.gov
    affiliations: Sandia National Laboratories
date: last-modified
---

## Outline

::: columns
::: {.column width="49.5%"}
-   Introduction
-   Functional Data Analysis
    -   Elastic Metric
-   Functional Changepoint Problem
    -   Elastic Approach
-   Results
    -   Simulation
    -   Mt. Pinatubo
:::

::: {.column width="49.5%"}
![](figs/era5_f.png)
:::
:::

## Introduction

::: {.column width="49.5%"}
-   Question: How can we model functions
    -   [Can we use them as predictors in a regression model?]{.blue}
    -   [Can we find a changepoint?]{.blue}
:::

::: {.column width="49.5%"}
![](figs/graphics-horiz-1.png)
:::

-   It is the same goal (question) of any area of statistical research
-   One problem occurs when performing these types of analysis is that functional data can contain variability in [time]{.alert} (x-direction) and [amplitude]{.alert} (y-direction)
-   How do we characterize and utilize this variability in the models that are constructed from functional data?

## FDA versus Multivariate Statistics

 In FDA, one develops the [theory]{.alert} on function spaces and not finite vectors, and discretizes the function only at the final step – compute implementation

<center>![](figs/ulf.png){height="250"}</center>

 Ulf Grenander: “[Discretize as late as possible]{.alert}” (1924-2016)

 Even after discretization, we retain the ability to interpolate resample as needed!

## Components of Function Variability

![](figs/function_var.png){.lightbox fig-align="center"}

## Classical FDA: Loss of Structure

-   Cross-sectional statistics ignore horizontal component, often [destroys structures]{.alert}

![](figs/classic_fda.png){fig-align="center" height="300"}

## Elastic FDA

![](figs/elastic_fda.png){fig-align="center" height="80%"}

## Functional Data Analysis 

::: {style="font-size: 90%;"}
-   Let $f$ be a real valued-function with the domain $[0,1]$, can be extended to any domain
    -   Only functions that are absolutely continuous on $[0,1]$
-   Let $\Gamma$ be the group of all warping functions $$ \Gamma = \{\gamma:[0,1]\rightarrow[0,1]|\gamma(0)=0,\gamma(1)=1,~\gamma \mbox{ is a diffeo}\} $$
-   It acts on the function space by composition $$(f,\gamma) = f\circ\gamma$$
-   It is common to use the following objective function for alignment $$\min_{\gamma\in\Gamma}\|f_1\circ\gamma-f_2\|$$
-   Note: It is [not a distance]{.alert} function since it is not symmetric.
:::

## Elastic Distance (Fisher-Rao)
::: {style="font-size: 90%;"}
Define the Square Root Velocity Function $$q:[0,1]\rightarrow\mathbb{R}^1,~q(t)=sign(\dot{f}(t))\sqrt{|\dot{f}(t)|}$$ Fisher Rao Distance is $\mathbb{L}^2$ in SRVF space $$d_a(f_1,f_2) = \inf_\gamma\|(q_1\circ\gamma)\sqrt{\dot{\gamma}}-q_2\|$$ Distance is a [proper distance]{.alert}

Can compute distance on warping functions (how much alignment) $$d_p(\gamma) = \arccos\left(\int_0^1\sqrt{\dot{\gamma}}\,dt\right)$$
:::

## Analysis of $\Gamma$

::: {.column width="49.5%"}
-   $\Gamma$ is a nonlinear manifold and it is infinite dimensional

-   Represent an element of $\gamma\in\Gamma$ by the square-root of its derivative: $\psi = \sqrt{\dot{\gamma}}$

-   Important advantage of this transformation is the set of all such $\psi$'s is a Hilbert Sphere $\mathbb{S}_\infty$
:::

::: {.column width="49.5%"}
<center>![](figs/spheremap_single.png){height="365"}</center>
:::

## Functional Changepoint Problem
-   Assume we have real-valued functions $f_1,\dots,f_n$ that are absolutely continuous on the interval $[0,1]$
-   The standard changepoint problem assumes the data is from the following model:
$$f_i = \mu + \delta \mathbb{1}(i > k^*) + \epsilon_i$$
- The point $k^*$ labels the time of the unknown mean change
- The changepoint detection problem then becomes a hypothesis testing problem of 
$$ H_0: \delta = 0~~\text{vs}~~H_A: \delta\neq 0 $$

## Functional Changepoint Problem
- Aue 2019 considers test statistic, $T_n = \max_{1 \leq  k \leq n} \lVert S_{n,k}\rVert^2$ where,
$$S_{n,k} = \frac{1}{\sqrt{n}} \left( k\mu_k -  k \mu_n\right)$$
- where $\mu_k = k^{-1} \sum_{i=1}^k f_i$
- Estimate of $k^*$
$$\hat{k}^*  =\arg\max_{1\leq k\leq n}\lVert S_{n,k}\rVert^2$$
- Does [not]{.alert} take into account both amplitude and phase variability

## Elastic Functional Changepoint
- We propose the model, based on the definition of $q$ and $\Gamma$
$$q_i = \left( (\mu_q + \delta_q \mathbb{1}(i > k^*) + \epsilon_i), \gamma_i^{-1}\right)$$
- Change point problem:
$$ H_0: \delta_q = 0~~\text{vs}~~H_A: \delta_q \neq 0 $$
- Test Statistic 
$$S_{n,k} = \frac{1}{\sqrt{n}}\left(k\mu_q^k-k\mu_q^n\right)$$
- where, $\mu_q^k = \arg\min_{q} \sum_{i=1}^k d_a(q,q_i)^2$

## Phase Changepoint Problem
- We consider a model for $\gamma_i$
$$ \gamma_i =\begin{cases}
\eta_i(\mu_{\gamma}) & \textrm{if } i \leq k^* \\
\eta_i(\nu_{\gamma}) & \textrm{if } i > k^*
\end{cases} $$
- where $\eta_i(\mu)$ denotes a random element of $\Gamma$ with mean $\mu \in \Gamma$
- Change Point Problem 
$$ H_0: \mu_{\gamma}= \nu_{\gamma}~~\text{vs}~~H_A: \mu_{\gamma}\neq \nu_{\gamma} $$
- Test Statistic using Hilbert Sphere representation
$$ S_{n,k} = \frac{1}{\sqrt{n}}\left(k\bar{v}^k - k \bar{v}^n\right) $$
- where $\bar{v}^k$ is the shooting vector of the Karcher mean of the warping functions 

## Simulation Amplitude Changepoint

::: {.column width="49.5%"}
![](figs/sim_amp_mean_compare.png)
:::

::: {.column width="49.5%"}
![](figs/sim_amp_data.png)
:::

- Mean Functions
$$ \begin{align*}
\mu(t) &= a_0\cos(2\pi t) + b_0\sin(2\pi t) + a_1\cos(4\pi t) + b_1\sin(4\pi t) \\
\delta(t) &= \Delta\cos(2\pi t) +  \Delta\sin(2\pi t) + \Delta\cos(4\pi t) + \Delta\sin(4\pi t)
\end{align*} $$
-  $a_i\sim U[0,1]$ and $b_i \sim U[0,1]$ and $\Delta=0.5$

## Simulation Phase Changepoint

::: {.column width="32%"}
<center>

![](figs/sim_phase_data.png)

</center>
:::

::: {.column width="32%"}
<center>

![](figs/sim_phase_est_means.png)

</center>
:::

::: {.column width="32%"}
<center>

![](figs/sim_phase_est_means_cs.png)

</center>
:::

- Same set up as before 
- We take $\delta(t)=0$, and the warping functions have mean $\gamma(t) = t$ before $k^*$
- After $k^*$, the mean of the warping functions is a randomly-generated warping function with variance $.15$

## MERRA-2 stratospheric temperature

::: {.column width="49.5%"}
![](figs/era5_f.png)
:::

::: {.column width="49.5%"}
- Stratospheric temperature of the climate reanalysis data MERRA-2
- Using data from the years 1984-1998, we aim to evaluate changes related to the eruption of Mt.\ Pinatubo in June 1991
- We focus on daily stratospheric temperature near the 50 millibar pressure surface
:::

## Changepoint Results at One Location

::: {.column width="32%"}
<center>

![Elastic](figs/example_ff_vert_fdata.png)

</center>
:::

::: {.column width="32%"}
<center>

![Standard](figs/example_ff_fdata.png)

</center>
:::

::: {.column width="32%"}
<center>

![Phase](figs/example_ff_vert_warp.png)

</center>
:::

- The elastic approach appears to align weather patterns, maintaining cyclical behavior in the temperature throughout the year. 
- In contrast, the cross-sectional approach averages these over years while ignoring phase variability. 
- No phase change detected

## Global Results
![](figs/map_ff_both_filter.png)
![](figs/map_ff_both_filter_change.png)

- Left: Elastic, Right: Cross-Sectional

## Summary

-   Proposed a new flexible elastic approach to functional changepoint detection that handles phase and amplitude variability in the data accordingly

-   Demonstrated its advantages over the state-of-the-art methods in the functional changepoint literature using both simulated and real data sets. 

-   Unlike the current cross-sectional methods, the elastic method accurately estimates the mean of the underlying data-generating mechanism

-   [Future Work]{.blue}

    -   Extend the method to the multiple change-point problem
    -   Fully Spatial Problem

## Papers

J. D. Tucker and D. Yarger, “Elastic Functional Changepoint Detection of Climate Impacts from Localized Sources”, Envirometrics, 10.1002/env.2826, 2023.

##  {background="#43464B" .center}

<center>

<font size="48">Questions?</font>

jdtuck\@sandia.gov

http://research.tetonedge.net

</center>
